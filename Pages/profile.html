<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Dossier - Mystery Hub</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <script>
        window.MYSTERY_HUB_CONFIG = {
            navbarClock: true
        };
    </script>
    <script src="../clock/clock.js"></script>
    <style>
        body {
            background-image: url('https://www.transparenttextures.com/patterns/old-paper.png'), 
                              url('https://www.transparenttextures.com/patterns/cardboard.png');
            background-color: var(--aged-paper);
        }
        
        .profile-container {
            max-width: 1000px;
            margin: 2rem auto;
        }
        
        /* Agent Dossier Header */
        .agent-dossier {
            background-color: var(--manila-folder);
            border: 1px solid var(--faded-ink);
            padding: 2rem;
            position: relative;
            box-shadow: 3px 3px 8px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            display: flex;
            align-items: flex-start;
        }
        
        .agent-dossier::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://www.transparenttextures.com/patterns/cardboard.png');
            opacity: 0.4;
            pointer-events: none;
        }
        
        .agent-photo-container {
            position: relative;
            margin-right: 2rem;
            flex-shrink: 0;
        }
        
        .agent-photo {
            width: 150px;
            height: 180px;
            border: 1px solid var(--faded-ink);
            background-color: rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .agent-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .agent-photo::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://www.transparenttextures.com/patterns/film-grain.png');
            opacity: 0.2;
            pointer-events: none;
        }
        
        .photo-paperclip {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 50px;
            border: 3px solid #a8a8a8;
            border-radius: 15px 15px 0 0;
            border-bottom: none;
            z-index: 10;
        }
        
        .agent-info {
            flex: 1;
            position: relative;
        }
        
        .agent-code-name {
            font-family: var(--typewriter-font);
            font-size: 1.8rem;
            color: var(--folder-red);
            margin-bottom: 0.5rem;
            border-bottom: 2px solid var(--folder-red);
            padding-bottom: 0.5rem;
            display: inline-block;
        }
        
        .agent-codename {
            font-family: var(--handwritten-font);
            font-size: 1.2rem;
            color: var(--dark-ink);
            margin-bottom: 1.5rem;
            font-style: italic;
        }
        
        .agent-details {
            margin-bottom: 1.5rem;
        }
        
        .agent-detail {
            display: flex;
            margin-bottom: 0.5rem;
        }
        
        .detail-label {
            font-family: var(--typewriter-font);
            color: var(--dark-ink);
            width: 120px;
            font-size: 0.9rem;
        }
        
        .detail-value {
            font-family: var(--handwritten-font);
            color: var(--dark-ink);
            flex: 1;
        }
        
        .agent-stats {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        .agent-stat {
            padding: 0.5rem 1rem;
            background-color: rgba(160, 44, 44, 0.1);
            font-family: var(--typewriter-font);
            font-size: 0.8rem;
            color: var(--folder-red);
            display: flex;
            align-items: center;
        }
        
        .agent-stat i {
            margin-right: 0.5rem;
        }
        
        .edit-profile-btn {
            padding: 0.7rem 1.2rem;
            background-color: var(--folder-red);
            color: var(--aged-paper);
            border: none;
            font-family: var(--typewriter-font);
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--folder-red);
            margin-top: 1rem;
            font-size: 0.9rem;
        }
        
        .edit-profile-btn:hover {
            background-color: transparent;
            color: var(--folder-red);
        }
        
        .clearance-stamp {
            position: absolute;
            top: 20px;
            right: 30px;
            transform: rotate(-15deg);
            color: var(--stamp-red);
            border: 2px solid var(--stamp-red);
            padding: 5px 12px;
            font-family: var(--typewriter-font);
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 1px;
        }
        
        .file-number {
            position: absolute;
            top: 10px;
            left: 20px;
            font-family: var(--typewriter-font);
            font-size: 0.8rem;
            color: var(--folder-red);
        }
        
        /* Tabs Styling */
        .dossier-tabs {
            display: flex;
            background-color: var(--manila-folder);
            position: relative;
            overflow: hidden;
        }
        
        .dossier-tabs::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://www.transparenttextures.com/patterns/cardboard.png');
            opacity: 0.4;
            pointer-events: none;
        }
        
        .dossier-tab {
            flex: 1;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-family: var(--typewriter-font);
            color: var(--dark-ink);
            border-bottom: 3px solid transparent;
            position: relative;
            z-index: 1;
        }
        
        .dossier-tab.active {
            background-color: rgba(160, 44, 44, 0.1);
            border-bottom: 3px solid var(--folder-red);
            color: var(--folder-red);
        }
        
        .dossier-tab:hover:not(.active) {
            background-color: rgba(160, 44, 44, 0.05);
        }
        
        /* Tab Content */
        .dossier-content {
            background-color: var(--manila-folder);
            padding: 2rem;
            position: relative;
            min-height: 400px;
            box-shadow: 3px 3px 8px rgba(0,0,0,0.1);
        }
        
        .dossier-content::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://www.transparenttextures.com/patterns/cardboard.png');
            opacity: 0.4;
            pointer-events: none;
        }
        
        .tab-content {
            display: none;
            position: relative;
            z-index: 1;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Case Files Grid */
        .case-files-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
        }
        
        .case-file-item {
            background-color: rgba(255, 255, 255, 0.4);
            border: 1px solid var(--faded-ink);
            position: relative;
            transition: all 0.3s;
            overflow: hidden;
        }
        
        .case-file-item:hover {
            transform: translateY(-5px);
            box-shadow: 3px 3px 10px rgba(0,0,0,0.15);
        }
        
        .case-file-img {
            height: 160px;
            overflow: hidden;
            position: relative;
        }
        
        .case-file-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: grayscale(30%);
            transition: all 0.3s;
        }
        
        .case-file-item:hover .case-file-img img {
            filter: grayscale(0%);
        }
        
        .case-file-img::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://www.transparenttextures.com/patterns/film-grain.png');
            opacity: 0.3;
        }
        
        .case-file-content {
            padding: 1rem;
        }
        
        .case-file-category {
            display: inline-block;
            padding: 3px 8px;
            background-color: var(--evidence-tape);
            font-family: var(--typewriter-font);
            font-size: 0.7rem;
            color: var(--dark-ink);
            margin-bottom: 0.5rem;
        }
        
        .case-file-title {
            font-family: var(--typewriter-font);
            font-size: 1.1rem;
            color: var(--folder-red);
            margin-bottom: 0.5rem;
        }
        
        .case-file-meta {
            font-family: var(--handwritten-font);
            font-size: 0.8rem;
            color: var(--faded-ink);
        }
        
        /* Form Styling */
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-family: var(--typewriter-font);
            color: var(--dark-ink);
        }
        
        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--faded-ink);
            background-color: rgba(255, 255, 255, 0.5);
            font-family: var(--handwritten-font);
            color: var(--dark-ink);
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--folder-red);
            box-shadow: 0 0 0 2px rgba(160, 44, 44, 0.1);
        }
        
        .dossier-section-title {
            font-family: var(--typewriter-font);
            color: var(--folder-red);
            margin-bottom: 1.5rem;
            border-bottom: 2px solid var(--folder-red);
            padding-bottom: 0.5rem;
            display: inline-block;
        }
        
        /* Star Rating */
        .star-rating {
            color: goldenrod;
            font-size: 1.2rem;
            letter-spacing: 2px;
        }
        
        /* Footer Styling */
        .fingerprint-bg {
            position: absolute;
            bottom: 20px;
            right: 30px;
            width: 120px;
            height: 120px;
            background-image: url('https://www.transparenttextures.com/patterns/fingerprint.png');
            opacity: 0.05;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <!-- Header with Navigation -->
    <header>
        <nav class="navbar">
            <div class="logo">
                <a href="../index.html">
                    <h1>Mystery<span>Hub</span></h1>
                </a>
            </div>
            <ul class="nav-links">
                <li><a href="../index.html">Home Base</a></li>
                <li><a href="../games/game1.html">Field Operations</a></li>
                <li><a href="../blog/blog.html">Case Files</a></li>
                <li><a href="../movies/movies.html">Evidence Archive</a></li>
                <li><a href="dashboard.html">Dashboard</a></li>
                <li class="profile-pic">
                    <img src="https://i.pravatar.cc/150?img=12" alt="User Profile">
                </li>
            </ul>
            <div class="menu-toggle">
                <i class="fas fa-bars"></i>
            </div>
        </nav>
    </header>

    <!-- Profile Content -->
    <section class="main-content">
        <div class="container">
            <div class="profile-container">
                <!-- Agent Dossier Header -->
                <div class="agent-dossier">
                    <div class="file-number">AGENT FILE #MH-2025-1142</div>
                    <div class="clearance-stamp">Level 3 Clearance</div>
                    
                    <div class="agent-photo-container">
                        <div class="photo-paperclip"></div>
                        <div class="agent-photo">
                            <img src="https://i.pravatar.cc/150?img=12" alt="Agent Photo">
                        </div>
                    </div>
                    
                    <div class="agent-info">
                        <h2 class="agent-code-name">Agent Jane D.</h2>
                        <div class="agent-codename">Codename: "Mystery Seeker"</div>
                        
                        <div class="agent-details">
                            <div class="agent-detail">
                                <div class="detail-label">Status:</div>
                                <div class="detail-value">Active Field Agent</div>
                            </div>
                            <div class="agent-detail">
                                <div class="detail-label">Division:</div>
                                <div class="detail-value">Investigation & Analysis</div>
                            </div>
                            <div class="agent-detail">
                                <div class="detail-label">Joined:</div>
                                <div class="detail-value">January 15, 2025</div>
                            </div>
                      
                        </div>
                        
                        <div class="agent-stats">
                            <div class="agent-stat">
                                <i class="fas fa-gamepad"></i> 5 Field Operations
                            </div>
                            <div class="agent-stat">
                                <i class="fas fa-book-open"></i> 8 Case Files
                            </div>
                            <div class="agent-stat">
                                <i class="fas fa-film"></i> 12 Evidence Logs
                            </div>
                        </div>
                        
                        <button class="edit-profile-btn" id="edit-profile-btn">
                            <i class="fas fa-pen"></i> Update Agent File
                        </button>
                    </div>
                </div>
                
                <!-- Profile Tabs -->
                <div class="dossier-tabs">
                    <div class="dossier-tab active" data-tab="field-ops">Field Operations</div>
                    <div class="dossier-tab" data-tab="case-files">Case Files</div>
                    <div class="dossier-tab" data-tab="evidence-logs">Evidence Logs</div>
                    <div class="dossier-tab" data-tab="agent-settings">Agent Settings</div>
                </div>
                
                <div class="dossier-content">
                    <!-- Field Operations Tab -->
                    <div class="tab-content active" id="field-ops">
                        <h3 class="dossier-section-title">ACTIVE FIELD OPERATIONS</h3>
                        <div class="case-files-grid">
                            <div class="case-file-item">
                                <div class="case-file-img">
                                    <img src="https://images.unsplash.com/photo-1599707367072-cd6ada2bc375?q=80&w=1000" alt="Mystery Game">
                                </div>
                                <div class="case-file-content">
                                    <span class="case-file-category">Field Operation</span>
                                    <h3 class="case-file-title">The Vanishing Artifact</h3>
                                    <p class="case-file-meta">Progress: 75% Complete</p>
                                </div>
                            </div>
                            
                            <div class="case-file-item">
                                <div class="case-file-img">
                                    <img src="https://images.unsplash.com/photo-1444703686981-a3abbc4d4fe3?q=80&w=1000" alt="Mystery Game">
                                </div>
                                <div class="case-file-content">
                                    <span class="case-file-category">Field Operation</span>
                                    <h3 class="case-file-title">Murder at Midnight</h3>
                                    <p class="case-file-meta">Progress: 100% Complete</p>
                                </div>
                            </div>
                            
                            <div class="case-file-item">
                                <div class="case-file-img">
                                    <img src="https://images.unsplash.com/photo-1635614017406-7c192d1f8b76?q=80&w=1000" alt="Mystery Game">
                                </div>
                                <div class="case-file-content">
                                    <span class="case-file-category">Field Operation</span>
                                    <h3 class="case-file-title">Escape the Crypt</h3>
                                    <p class="case-file-meta">Status: Not Started</p>
                                </div>
                            </div>
                        </div>
                        <div class="fingerprint-bg"></div>
                    </div>
                    
                    <!-- Case Files Tab -->
                    <div class="tab-content" id="case-files">
                        <h3 class="dossier-section-title">ARCHIVED CASE FILES</h3>
                        <div class="case-files-grid">
                            <div class="case-file-item">
                                <div class="case-file-img">
                                    <img src="https://images.unsplash.com/photo-1487821619655-4943a3202619?q=80&w=1000" alt="Case File">
                                </div>
                                <div class="case-file-content">
                                    <span class="case-file-category">True Crime</span>
                                    <h3 class="case-file-title">The Zodiac Killer</h3>
                                    <p class="case-file-meta">Archived: April 12, 2025</p>
                                </div>
                            </div>
                            
                            <div class="case-file-item">
                                <div class="case-file-img">
                                    <img src="https://images.unsplash.com/photo-1600028814234-74d89d77ea21?q=80&w=1000" alt="Case File">
                                </div>
                                <div class="case-file-content">
                                    <span class="case-file-category">Cold Case</span>
                                    <h3 class="case-file-title">The Black Dahlia</h3>
                                    <p class="case-file-meta">Archived: April 10, 2025</p>
                                </div>
                            </div>
                            
                            <div class="case-file-item">
                                <div class="case-file-img">
                                    <img src="https://images.unsplash.com/photo-1580137189272-c9379f8864fd?q=80&w=1000" alt="Case File">
                                </div>
                                <div class="case-file-content">
                                    <span class="case-file-category">Unsolved</span>
                                    <h3 class="case-file-title">The Somerton Man</h3>
                                    <p class="case-file-meta">Archived: April 5, 2025</p>
                                </div>
                            </div>
                        </div>
                        <div class="fingerprint-bg"></div>
                    </div>
                    
                    <!-- Evidence Logs Tab -->
                    <div class="tab-content" id="evidence-logs">
                        <h3 class="dossier-section-title">EVIDENCE CATALOG</h3>
                        <div class="case-files-grid">
                            <div class="case-file-item">
                                <div class="case-file-img">
                                    <img src="https://images.unsplash.com/photo-1485846234645-a62644f84728?q=80&w=1000" alt="Evidence Log">
                                </div>
                                <div class="case-file-content">
                                    <span class="case-file-category">Film Evidence</span>
                                    <h3 class="case-file-title">Knives Out</h3>
                                    <p class="case-file-meta">Analysis Rating: <span class="star-rating">★★★★★</span></p>
                                </div>
                            </div>
                            
                            <div class="case-file-item">
                                <div class="case-file-img">
                                    <img src="https://images.unsplash.com/photo-1536440136628-849c177e76a1?q=80&w=1000" alt="Evidence Log">
                                </div>
                                <div class="case-file-content">
                                    <span class="case-file-category">Film Evidence</span>
                                    <h3 class="case-file-title">Shutter Island</h3>
                                    <p class="case-file-meta">Analysis Rating: <span class="star-rating">★★★★☆</span></p>
                                </div>
                            </div>
                            
                            <div class="case-file-item">
                                <div class="case-file-img">
                                    <img src="https://images.unsplash.com/photo-1478720568477-152d9b164e26?q=80&w=1000" alt="Evidence Log">
                                </div>
                                <div class="case-file-content">
                                    <span class="case-file-category">Film Evidence</span>
                                    <h3 class="case-file-title">Gone Girl</h3>
                                    <p class="case-file-meta">Analysis Rating: <span class="star-rating">★★★★★</span></p>
                                </div>
                            </div>
                        </div>
                        <div class="fingerprint-bg"></div>
                    </div>
                    
                    <!-- Agent Settings Tab -->
                    <div class="tab-content" id="agent-settings">
                        <h3 class="dossier-section-title">AGENT FILE MAINTENANCE</h3>
                        <form id="profile-settings-form">
                            <div class="form-group">
                                <label for="display-name">Agent Name</label>
                                <input type="text" id="display-name" name="display-name" value="Jane Doe" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="username">Codename</label>
                                <input type="text" id="username" name="username" value="mysterylover" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="email">Secure Contact</label>
                                <input type="email" id="email" name="email" value="jane.doe@example.com" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="bio">Field Notes</label>
                                <textarea id="bio" name="bio" rows="4" class="form-control">Mystery enthusiast and amateur detective. I love solving puzzles and reading true crime stories.</textarea>
                            </div>
                            <div class="form-group">
                                <label for="new-password">New Security Key (leave blank to keep current)</label>
                                <input type="password" id="new-password" name="new-password" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="confirm-password">Verify Security Key</label>
                                <input type="password" id="confirm-password" name="confirm-password" class="form-control">
                            </div>
                            <button type="submit" class="edit-profile-btn">
                                <i class="fas fa-save"></i> Submit Updates
                            </button>
                        </form>
                        <div class="fingerprint-bg"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Navigation</h3>
                    <ul class="footer-links">
                        <li><a href="../index.html">Home Base</a></li>
                        <li><a href="../games/game1.html">Field Operations</a></li>
                        <li><a href="../blog/blog.html">Case Files</a></li>
                        <li><a href="../movies/movies.html">Evidence Archive</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Legal Notice</h3>
                    <p>All case files contained herein are property of Mystery Hub Investigations. Unauthorized access will be prosecuted.</p>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2025 Mystery Hub | Bintu Jalloh & Michelle Lawson</p>
            </div>
        </div>
    </footer>
    
    <script>
        // Tab switching functionality
        document.addEventListener('DOMContentLoaded', function() {
            const tabs = document.querySelectorAll('.dossier-tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Remove active class from all tabs and contents
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    // Add active class to current tab and content
                    this.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            // Load user profile data from backend
            fetchProfileData();
            
            // Form submission handling
            const profileForm = document.getElementById('profile-settings-form');
            if (profileForm) {
                profileForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    updateProfile(this);
                });
            }
        });
        
        // Fetch user profile data from the backend API
        function fetchProfileData() {
            // Display loading state
            displayFlashMessage('info', 'Loading agent data...', false);
            
            fetch('../Backend/Php/get_profile_data.php')
                .then(response => response.json())
                .then(data => {
                    if (!data.success) {
                        // If not logged in, redirect to login page
                        if (data.redirect) {
                            window.location.href = data.redirect;
                            return;
                        }
                        displayFlashMessage('error', data.message || 'Failed to load profile data.');
                        return;
                    }
                    
                    // Update profile data in the UI
                    updateProfileUI(data);
                    
                    // Display any flash messages
                    if (data.flash_messages) {
                        for (const type in data.flash_messages) {
                            for (const message of data.flash_messages[type]) {
                                displayFlashMessage(type, message);
                            }
                        }
                    }
                })
                .catch(error => {
                    console.error('Error fetching profile data:', error);
                    displayFlashMessage('error', 'Failed to connect to the server. Please try again later.');
                });
        }
        
        // Update the UI with profile data
        function updateProfileUI(data) {
            // User name and codename
            document.querySelector('.agent-code-name').textContent = data.display.displayName;
            document.querySelector('.agent-codename').textContent = 'Codename: "' + data.user.username + '"';
            
            // Agent details
            document.querySelectorAll('.agent-detail').forEach(detail => {
                const label = detail.querySelector('.detail-label');
                if (label) {
                    const value = detail.querySelector('.detail-value');
                    if (label.textContent === 'Joined:') {
                        value.textContent = data.display.joinDate;
                    } else if (label.textContent === 'Division:') {
                        value.textContent = data.user.expertise || 'Investigation & Analysis';
                    } else if (label.textContent === 'Status:') {
                        value.textContent = 'Active Field Agent';
                    }
                }
            });
            
            // Stats
            const statsElements = document.querySelectorAll('.agent-stat');
            statsElements.forEach(stat => {
                const icon = stat.querySelector('i');
                if (icon) {
                    if (icon.classList.contains('fa-gamepad')) {
                        stat.innerHTML = `<i class="fas fa-gamepad"></i> ${data.stats.completedGames} Field Operations`;
                    } else if (icon.classList.contains('fa-book-open')) {
                        stat.innerHTML = `<i class="fas fa-book-open"></i> ${data.stats.favoriteBlogs} Case Files`;
                    } else if (icon.classList.contains('fa-film')) {
                        stat.innerHTML = `<i class="fas fa-film"></i> ${data.stats.favoriteMovies} Evidence Logs`;
                    }
                }
            });
            
            // Profile form
            const profileForm = document.getElementById('profile-settings-form');
            if (profileForm) {
                const firstnameInput = profileForm.querySelector('#display-name');
                if (firstnameInput) {
                    firstnameInput.value = data.user.firstname + ' ' + data.user.lastname;
                }
                
                const usernameInput = profileForm.querySelector('#username');
                if (usernameInput) {
                    usernameInput.value = data.user.username;
                }
                
                const emailInput = profileForm.querySelector('#email');
                if (emailInput) {
                    emailInput.value = data.user.email;
                }
                
                const bioInput = profileForm.querySelector('#bio');
                if (bioInput) {
                    bioInput.value = data.user.bio || '';
                }
            }
        }
        
        // Update profile via API
        function updateProfile(form) {
            const formData = new FormData(form);
            
            // Display loading state
            displayFlashMessage('info', 'Updating profile...', false);
            
            fetch('../Backend/Php/update_profile.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    displayFlashMessage('success', data.message || 'Profile updated successfully!');
                    // Reload profile data to show updated information
                    fetchProfileData();
                } else {
                    displayFlashMessage('error', data.message || 'Failed to update profile.');
                    
                    // Display individual validation errors
                    if (data.errors && Array.isArray(data.errors)) {
                        data.errors.forEach(error => {
                            displayFlashMessage('error', error);
                        });
                    }
                }
            })
            .catch(error => {
                console.error('Error updating profile:', error);
                displayFlashMessage('error', 'Failed to connect to the server. Please try again later.');
            });
        }
        
        // Display flash messages
        function displayFlashMessage(type, message, autoHide = true) {
            // Create container if it doesn't exist
            let flashContainer = document.querySelector('.flash-messages');
            if (!flashContainer) {
                flashContainer = document.createElement('div');
                flashContainer.className = 'flash-messages';
                document.body.insertBefore(flashContainer, document.body.firstChild);
                
                // Add styles if not already present
                if (!document.getElementById('flash-message-styles')) {
                    const style = document.createElement('style');
                    style.id = 'flash-message-styles';
                    style.textContent = `
                        .flash-messages {
                            position: fixed;
                            top: 20px;
                            right: 20px;
                            max-width: 350px;
                            z-index: 9999;
                            font-family: var(--typewriter-font, 'Special Elite', courier, monospace);
                        }
                        .flash-message {
                            margin-bottom: 10px;
                            padding: 12px 15px;
                            border-radius: 4px;
                            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
                            position: relative;
                            animation: slidein 0.3s ease-in-out;
                            transition: opacity 0.3s ease;
                        }
                        .flash-success {
                            background-color: #d4edda;
                            border-left: 4px solid #28a745;
                            color: #155724;
                        }
                        .flash-error {
                            background-color: #f8d7da;
                            border-left: 4px solid #dc3545;
                            color: #721c24;
                        }
                        .flash-info {
                            background-color: #d1ecf1;
                            border-left: 4px solid #17a2b8;
                            color: #0c5460;
                        }
                        .flash-close {
                            position: absolute;
                            top: 8px;
                            right: 8px;
                            cursor: pointer;
                            opacity: 0.7;
                            transition: opacity 0.2s;
                        }
                        .flash-close:hover {
                            opacity: 1;
                        }
                        @keyframes slidein {
                            from {
                                transform: translateX(30px);
                                opacity: 0;
                            }
                            to {
                                transform: translateX(0);
                                opacity: 1;
                            }
                        }
                    `;
                    document.head.appendChild(style);
                }
            }
            
            // Create message element
            const messageElement = document.createElement('div');
            messageElement.className = `flash-message flash-${type}`;
            
            // Add icon based on message type
            let icon = '';
            switch (type) {
                case 'success':
                    icon = '<i class="fas fa-check-circle"></i>';
                    break;
                case 'error':
                    icon = '<i class="fas fa-exclamation-circle"></i>';
                    break;
                case 'info':
                    icon = '<i class="fas fa-info-circle"></i>';
                    break;
            }
            
            messageElement.innerHTML = `${icon} ${message}<span class="flash-close"><i class="fas fa-times"></i></span>`;
            flashContainer.appendChild(messageElement);
            
            // Add close button functionality
            const closeButton = messageElement.querySelector('.flash-close');
            closeButton.addEventListener('click', function() {
                messageElement.style.opacity = '0';
                setTimeout(() => {
                    messageElement.remove();
                }, 300);
            });
            
            // Auto-hide after 5 seconds
            if (autoHide) {
                setTimeout(function() {
                    if (messageElement.parentElement) {
                        messageElement.style.opacity = '0';
                        setTimeout(() => {
                            if (messageElement.parentElement) {
                                messageElement.remove();
                            }
                        }, 300);
                    }
                }, 5000);
            }
            
            return messageElement;
        }
    </script>
</body>
</html>
